<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Card Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 10px; }
        .btn-primary { background-color: #007bff; border-color: #007bff; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; border-color: #28a745; }
        .btn-success:hover { background-color: #1e7e34; }
        .btn-danger { background-color: #dc3545; border-color: #dc3545; }
        .btn-danger:hover { background-color: #c82333; }
        .btn-warning { background-color: #ffc107; border-color: #ffc107; color: #212529; }
        .btn-warning:hover { background-color: #e0a800; }
        table { margin-top: 20px; }
        .search-container { margin-bottom: 20px; }
        .search-container input { width: 100%; max-width: 400px; }
        .loading { color: #007bff; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card p-4 mb-4">
            <h1 class="text-center mb-4">Business Card Scanner</h1>
            <p class="text-center text-muted">Upload front and back images of business cards, scan to extract data, and search through your scanned cards. Data can be exported to Excel.</p>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="frontImage" class="form-label">Front Image:</label>
                    <input type="file" class="form-control" id="frontImage" accept="image/*">
                </div>
                <div class="col-md-6">
                    <label for="backImage" class="form-label">Back Image (optional):</label>
                    <input type="file" class="form-control" id="backImage" accept="image/*">
                </div>
            </div>
            
            <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
                <button class="btn btn-primary" onclick="scanCards()">Scan Card</button>
                <button class="btn btn-success" onclick="exportToExcel()">Export to Excel</button>
                <button class="btn btn-danger" onclick="clearTable()">Clear Table</button>
                <button class="btn btn-warning" onclick="saveToLocalStorage()">Save to Browser</button>
                <button class="btn btn-info" onclick="loadFromLocalStorage()">Load from Browser</button>
            </div>
        </div>
        
        <div class="card p-4">
            <div class="search-container">
                <input type="text" class="form-control" id="searchInput" placeholder="Search in table (e.g., company name, email)...">
            </div>
            
            <table class="table table-striped table-hover" id="dataTable">
                <thead class="table-dark">
                    <tr>
                        <th>Company Name</th>
                        <th>Contact Person</th>
                        <th>Mobile Number</th>
                        <th>Email ID</th>
                        <th>Designation</th>
                        <th>Website</th>
                        <th>Location</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Load saved data when page loads
        window.onload = loadFromLocalStorage;
        
        async function scanCards() {
            const frontFile = document.getElementById('frontImage').files[0];
            if (!frontFile) {
                alert('Please upload the front image.');
                return;
            }
            
            const backFile = document.getElementById('backImage').files[0];
            
            const tableBody = document.getElementById('tableBody');
            const loadingRow = document.createElement('tr');
            loadingRow.innerHTML = '<td colspan="7" class="loading text-center">Processing... This may take a few seconds.</td>';
            tableBody.appendChild(loadingRow);
            
            try {
                const frontText = await Tesseract.recognize(frontFile, 'eng').then(result => result.data.text);
                let backText = '';
                if (backFile) {
                    backText = await Tesseract.recognize(backFile, 'eng').then(result => result.data.text);
                }
                
                const fullText = frontText + ' ' + backText;
                
                const data = {
                    company: extractField(fullText, /(?:company|corp|inc|llc|co\.?)[:\s]*([^\n\r]+)/i),
                    name: extractField(fullText, /(?:name|contact|person)[:\s]*([A-Za-z\s]+)/i),
                    mobile: extractField(fullText, /(?:mobile|phone|tel|cell)[:\s]*(\+?\d[\d\s\-\$\$]{8,})/i),
                    email: extractField(fullText, /([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/i),
                    designation: extractField(fullText, /(?:designation|title|position|role)[:\s]*([^\n\r]+)/i),
                    website: extractField(fullText, /(?:website|www\.|http[s]?:\/\/)[:\s]*([^\s\n\r]+)/i),
                    location: extractField(fullText, /(?:address|location|city|state|country)[:\s]*([^\n\r]+)/i)
                };
                
                tableBody.removeChild(loadingRow);
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${data.company || 'N/A'}</td>
                    <td>${data.name || 'N/A'}</td>
                    <td>${data.mobile || 'N/A'}</td>
                    <td>${data.email || 'N/A'}</td>
                    <td>${data.designation || 'N/A'}</td>
                    <td>${data.website || 'N/A'}</td>
                    <td>${data.location || 'N/A'}</td>
                `;
                tableBody.appendChild(newRow);
                
                document.getElementById('frontImage').value = '';
                document.getElementById('backImage').value = '';
                
                // Auto-save to browser storage
                saveToLocalStorage();
                
                alert('Card scanned successfully!');
            } catch (error) {
                alert('Error during scanning: ' + error.message);
                tableBody.removeChild(loadingRow);
            }
        }
        
        function extractField(text, regex) {
            const match = text.match(regex);
            return match ? match[1].trim() : null;
        }
        
        function exportToExcel() {
            const table = document.getElementById('dataTable');
            if (table.rows.length <= 1) {
                alert('No data to export. Scan some cards first.');
                return;
            }
            const wb = XLSX.utils.table_to_book(table);
            XLSX.writeFile(wb, 'business_cards.xlsx');
        }
        
        function saveToLocalStorage() {
            const data = [];
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                data.push({
                    company: cells[0].textContent,
                    name: cells[1].textContent,
                    mobile: cells[2].textContent,
                    email: cells[3].textContent,
                    designation: cells[4].textContent,
                    website: cells[5].textContent,
                    location: cells[6].textContent
                });
            });
            
            localStorage.setItem('businessCards', JSON.stringify(data));
            alert('Data saved to browser storage!');
        }
        
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('businessCards');
            if (savedData) {
                const data = JSON.parse(savedData);
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';
                
                data.forEach(card => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${card.company || 'N/A'}</td>
                        <td>${card.name || 'N/A'}</td>
                        <td>${card.mobile || 'N/A'}</td>
                        <td>${card.email || 'N/A'}</td>
                        <td>${card.designation || 'N/A'}</td>
                        <td>${card.website || 'N/A'}</td>
                        <td>${card.location || 'N/A'}</td>
                    `;
                    tableBody.appendChild(newRow);
                });
                alert('Loaded ' + data.length + ' cards from browser storage.');
            }
        }
        
        function clearTable() {
            if (confirm('Are you sure you want to clear all data?')) {
                document.getElementById('tableBody').innerHTML = '';
                localStorage.removeItem('businessCards');
            }
        }
        
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });
    </script>
</body>
</html>